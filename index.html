<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ANNABYTE - V3.09</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<style>
    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; padding: 0; font-family: 'Verdana', sans-serif; height: 100vh; width: 100vw; overflow: hidden; background-color: #f0f0f0; display: flex; flex-direction: row; }
    
    @media (max-width: 800px) {
        body { flex-direction: column; overflow-y: auto; }
        #side-watermark { width: 100% !important; height: 25vh !important; }
        #game-area { width: 100% !important; height: 75vh !important; padding: 5px; }
        /* No mobile, mantemos a largura relativa para n√£o estourar */
        .painel, #tabuleiro-container { width: 98% !important; min-width: auto !important; padding: 15px !important; }
        #grid { transform: scale(0.65); transform-origin: top center; }
    }

    #side-watermark { 
        position: relative; width: 40%; height: 100%; 
        background-image: url('annasarah.jpeg?v=3.01'); background-size: cover; background-position: center top; 
        filter: grayscale(100%) contrast(1.1); opacity: 0.8; 
        -webkit-mask-image: linear-gradient(to right, black 75%, transparent 100%);
        mask-image: linear-gradient(to right, black 75%, transparent 100%);
        z-index: 1; 
    }
    
    /* Centraliza a √°rea de conte√∫do */
    #game-area { width: 60%; height: 100%; display: flex; align-items: center; justify-content: center; position: relative; z-index: 10; }
    
    /* MODIFICA√á√ÉO: A Tela de Apresenta√ß√£o agora √© fixa em 380px */
    .painel { 
        width: 380px; padding: 25px; background: white; border-radius: 20px; 
        box-shadow: 0 15px 40px rgba(0,0,0,0.1); text-align: center; border: 4px solid #ff9800; 
        position: relative;
    }

    /* MODIFICA√á√ÉO: O Tabuleiro de Jogo cresce conforme o grid (fit-content) */
    #tabuleiro-container { 
        width: fit-content; min-width: 380px; padding: 25px; background: white; border-radius: 20px; 
        box-shadow: 0 15px 40px rgba(0,0,0,0.1); text-align: center; border: 4px solid #ff9800; 
        position: relative;
    }

    #hud-box {
        display: flex; justify-content: space-between; align-items: center;
        background: #fff5e6; padding: 8px 15px; border-radius: 12px;
        margin-bottom: 15px; border: 2px solid #ffcc80;
    }

    h1 { color: #e65100; margin: 0 0 10px 0; font-size: 28px; text-transform: uppercase; font-weight: 900; }
    input, select { width: 100%; padding: 10px; margin-bottom: 8px; border: 2px solid #ccc; border-radius: 10px; font-size: 16px; text-align: center; font-weight: bold; }
    
    .botoes-container { display: flex; gap: 15px; margin: 10px 0; justify-content: center; }
    .btn-bola { width: 70px; height: 70px; border-radius: 50%; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 13px; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
    .btn-jogar { background: #2ecc71; border: 3px solid white; }
    .btn-sair { background: #ff7675; border: 3px solid white; }

    #ranking-area { width: 100%; height: 120px; overflow-y: auto; background: #fafafa; border: 1px solid #eee; border-radius: 8px; text-align: left; padding: 8px; }
    
    #tela-jogo { display: none; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; }
    #grid { display: grid; gap: 6px; justify-content: center; margin: 0 auto; }
    
    .card { width: 65px; height: 65px; background: linear-gradient(135deg, #ff9800, #f57c00); border-radius: 6px; cursor: pointer; position: relative; box-shadow: 0 4px 0 #8a3100; transition: transform 0.1s; }
    .card:active { transform: translateY(2px); box-shadow: 0 1px 0 #8a3100; }
    .frente { position: absolute; width: 100%; height: 100%; background: white; border-radius: 6px; display: none; border: 2px solid #ff9800; overflow: hidden; }
    .frente img { width: 100%; height: 100%; object-fit: cover; }
    .card.virada .frente, .card.certa .frente { display: block; }

    #btn-voltar-jogo {
        border: none; background: #d63031; color: white; border-radius: 5px; padding: 8px 20px; font-weight: bold;
        position: absolute; bottom: -55px; left: 50%; transform: translateX(-50%); cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    #sound-panel { position: fixed; top: 10px; right: 10px; z-index: 200; background: white; padding: 5px; border-radius: 30px; display: flex; align-items: center; border: 1px solid #ccc; }
</style>
</head>
<body onclick="interacaoInicial()">

    <audio id="musica-menu" loop preload="auto">
        <source src="abertura.mp3" type="audio/mpeg">
    </audio>

    <audio id="musica-jogo" loop preload="auto">
        <source src="flauta.mp3" type="audio/mpeg">
    </audio>

    <audio id="som-ding" src="https://www.myinstants.com/media/sounds/ding-sound-effect_2.mp3"></audio>
    <audio id="som-win" src="https://www.myinstants.com/media/sounds/victory-ff-fanfare.mp3"></audio>

    <div id="side-watermark"></div>

    <div id="sound-panel">
        <button id="btn-mute" onclick="toggleMute()" style="border:none; background:none; cursor:pointer;">üîä</button>
        <input type="range" id="vol-slider" min="0" max="1" step="0.1" value="0.5" oninput="mudarVolume()" style="width:60px;">
    </div>

    <div id="game-area">
        <div id="tela-menu">
            <div class="painel">
                <div style="background:#ff9800; color:white; border-radius:10px; font-size:11px; padding:2px; margin-bottom:10px;">ANNABYTE v3.09</div>
                <h1>MENU</h1>
                <input id="jogador" type="text" placeholder="Nome do Jogador">
                <select id="tema">
                    <option value="naruto">üç• TURMA DO NARUTO</option>
                    <option value="futebol">‚öΩ FLAMENGO / FUTEBOL</option>
                    <option value="carros">üèéÔ∏è CARROS GSI</option>
                </select>
                <select id="nivel">
                    <option value="4x4">F√ÅCIL (4x4)</option>
                    <option value="6x5">M√âDIO (6x5)</option>
                    <option value="8x6">DIF√çCIL (8x6)</option>
                </select>
                <div class="botoes-container">
                    <button class="btn-bola btn-jogar" onclick="iniciar()">JOGAR</button>
                    <button class="btn-bola btn-sair" onclick="fecharApp()">SAIR</button>
                </div>
                <div id="ranking-area"></div>
            </div>
        </div>

        <div id="tela-jogo">
            <div id="tabuleiro-container">
                <div id="hud-box">
                    <span id="nome-hud" style="color:#e65100; font-weight:900;">PLAYER</span>
                    <span id="tempo" style="background:#ff9800; color:white; padding:2px 8px; border-radius:5px;">0.0s</span>
                </div>
                <div id="grid"></div>
                <button id="btn-voltar-jogo" onclick="voltarMenu()">VOLTAR</button>
            </div>
        </div>
    </div>

<script>
    let canalMenu = document.getElementById('musica-menu'); 
    let canalJogo = document.getElementById('musica-jogo');

    let isMuted = false;
    let interagiu = false;
    let viradas = [];
    let travado = false;
    let acertos = 0;
    let timerLoop;
    let segundos = 0;

    const DB = {
        naruto: ["https://tse2.mm.bing.net/th?q=Naruto+Chibi","https://tse2.mm.bing.net/th?q=Sasuke+Chibi","https://tse2.mm.bing.net/th?q=Sakura+Chibi","https://tse2.mm.bing.net/th?q=Kakashi+Chibi","https://tse2.mm.bing.net/th?q=Hinata+Chibi","https://tse2.mm.bing.net/th?q=Gaara+Chibi","https://tse2.mm.bing.net/th?q=Itachi+Chibi","https://tse2.mm.bing.net/th?q=Jiraiya+Chibi","https://tse2.mm.bing.net/th?q=Tsunade+Chibi","https://tse2.mm.bing.net/th?q=Obito+Chibi","https://tse2.mm.bing.net/th?q=Madara+Chibi","https://tse2.mm.bing.net/th?q=Kurama+Chibi","https://tse2.mm.bing.net/th?q=Minato+Chibi","https://tse2.mm.bing.net/th?q=RockLee+Chibi","https://tse2.mm.bing.net/th?q=Shikamaru+Chibi","https://tse2.mm.bing.net/th?q=Pain+Chibi","https://tse2.mm.bing.net/th?q=Konan+Chibi","https://tse2.mm.bing.net/th?q=Deidara+Chibi","https://tse2.mm.bing.net/th?q=Hidan+Chibi","https://tse2.mm.bing.net/th?q=Kisame+Chibi","https://tse2.mm.bing.net/th?q=Orochimaru+Chibi","https://tse2.mm.bing.net/th?q=Boruto+Chibi","https://tse2.mm.bing.net/th?q=Sarada+Chibi","https://tse2.mm.bing.net/th?q=Mitsuki+Chibi"],
        futebol: ["https://tse2.mm.bing.net/th?q=Flamengo+Logo","https://tse2.mm.bing.net/th?q=Zico+Cartoon","https://tse2.mm.bing.net/th?q=Gabigol+Cartoon","https://tse2.mm.bing.net/th?q=Arrascaeta+Cartoon","https://tse2.mm.bing.net/th?q=BrunoHenrique+Cartoon","https://tse2.mm.bing.net/th?q=Soccer+Ball","https://tse2.mm.bing.net/th?q=Maracana","https://tse2.mm.bing.net/th?q=Soccer+Trophy","https://tse2.mm.bing.net/th?q=Football+Boots","https://tse2.mm.bing.net/th?q=Referee","https://tse2.mm.bing.net/th?q=Goalkeeper+Gloves","https://tse2.mm.bing.net/th?q=Football+Field","https://tse2.mm.bing.net/th?q=Red+Card","https://tse2.mm.bing.net/th?q=Corner+Flag","https://tse2.mm.bing.net/th?q=Whistle","https://tse2.mm.bing.net/th?q=Soccer+Jersey","https://tse2.mm.bing.net/th?q=World+Cup+Logo","https://tse2.mm.bing.net/th?q=Stadium+Lights","https://tse2.mm.bing.net/th?q=Captains+Armband","https://tse2.mm.bing.net/th?q=Soccer+Fan+Cartoon","https://tse2.mm.bing.net/th?q=Champions+League+Ball","https://tse2.mm.bing.net/th?q=Linesman+Flag","https://tse2.mm.bing.net/th?q=Training+Cone","https://tse2.mm.bing.net/th?q=Stopwatch"],
        carros: ["https://tse2.mm.bing.net/th?q=Astra+GSI+Red","https://tse2.mm.bing.net/th?q=Ferrari+F40+Cartoon","https://tse2.mm.bing.net/th?q=Porsche+911+Cartoon","https://tse2.mm.bing.net/th?q=Lamborghini+Cartoon","https://tse2.mm.bing.net/th?q=Camaro+Cartoon","https://tse2.mm.bing.net/th?q=Fusca+Cartoon","https://tse2.mm.bing.net/th?q=Mustang+Cartoon","https://tse2.mm.bing.net/th?q=Race+Car","https://tse2.mm.bing.net/th?q=Formula1+Car","https://tse2.mm.bing.net/th?q=Monster+Truck","https://tse2.mm.bing.net/th?q=Police+Car","https://tse2.mm.bing.net/th?q=Taxi+Cartoon","https://tse2.mm.bing.net/th?q=School+Bus+Cartoon","https://tse2.mm.bing.net/th?q=Tractor+Cartoon","https://tse2.mm.bing.net/th?q=Ambulance+Cartoon","https://tse2.mm.bing.net/th?q=Fire+Truck+Cartoon","https://tse2.mm.bing.net/th?q=Jeep+Cartoon","https://tse2.mm.bing.net/th?q=Classic+Car+Cartoon","https://tse2.mm.bing.net/th?q=Motorcycle+Cartoon","https://tse2.mm.bing.net/th?q=Steering+Wheel","https://tse2.mm.bing.net/th?q=Car+Engine+Cartoon","https://tse2.mm.bing.net/th?q=Speedometer+Cartoon","https://tse2.mm.bing.net/th?q=Fuel+Pump+Cartoon","https://tse2.mm.bing.net/th?q=Car+Key+Cartoon"]
    };

    function fisherYates(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function interacaoInicial() { 
    if (!interagiu) { 
        interagiu = true; 
        if(!isMuted) {
            // Liga o tema do Naruto imediatamente
            canalMenu.play().catch(e => console.log("Aguardando intera√ß√£o"));
            
            // "Engatilha" a flauta em sil√™ncio para o navegador permitir depois
            canalJogo.play().then(() => {
                canalJogo.pause();
                canalJogo.currentTime = 0;
            }).catch(e => {});
        } 
    } 
} 

    function toggleMute() { 
        isMuted = !isMuted; 
        document.getElementById('btn-mute').innerText = isMuted ? "üîá" : "üîä"; 
        isMuted ? som.pause() : som.play().catch(()=>{}); 
    }
    
    function mudarVolume() { som.volume = document.getElementById('vol-slider').value; }

    // 2. FUN√á√ÉO INICIAR (Quando clica no bot√£o JOGAR)
function iniciar() {
    let nome = document.getElementById('jogador').value;
    if(!nome) return alert("Digite seu nome!");

    // TROCA DE √ÅUDIO FOR√áADA
    if(!isMuted) {
        canalMenu.pause(); 
        canalJogo.currentTime = 0;
        // Como o arquivo √© local, o play() √© quase instant√¢neo
        canalJogo.play().catch(e => console.log("Erro ao tocar arquivo local"));
    }
        
        // Espera um mil√©simo de segundo para o 'load' processar
        setTimeout(() => {
            canalJogo.play().catch(e => {console.log("Erro ao reconhecer o arquivo:", e);
            });
        }, 150);
    

    let tema = document.getElementById('tema').value;
    let nivelSel = document.getElementById('nivel').value;
    
    let partes = nivelSel.split('x');
    let linhas = parseInt(partes[0]);
    let colunas = parseInt(partes[1]);
    let qtdTotal = linhas * colunas;
    let qtdPares = qtdTotal / 2;
    
    document.getElementById('nome-hud').innerText = nome.toUpperCase();
    document.getElementById('tela-menu').style.display = 'none';
    document.getElementById('tela-jogo').style.display = 'flex';

    let selecionadas = DB[tema].slice(0, qtdPares);
    let deck = fisherYates([...selecionadas, ...selecionadas]);

    const grid = document.getElementById('grid');
    grid.style.gridTemplateColumns = `repeat(${colunas}, 65px)`;
    grid.innerHTML = "";
    
    deck.forEach((img) => {
        let div = document.createElement('div');
        div.className = 'card';
        div.dataset.id = img;
        div.innerHTML = `<div class="frente"><img src="${img}"></div>`;
        div.onclick = () => clicar(div, qtdPares);
        grid.appendChild(div);
    });

    segundos = 0; acertos = 0; viradas = []; travado = false;
    clearInterval(timerLoop);
    timerLoop = setInterval(() => { 
        segundos += 0.1; 
        document.getElementById('tempo').innerText = segundos.toFixed(1) + 's'; 
    }, 100);
}

    function clicar(card, totalPares) {
        if(travado || card.classList.contains('virada') || card.classList.contains('certa')) return;
        card.classList.add('virada');
        viradas.push(card);

        if(viradas.length === 2) {
            travado = true;
            if(viradas[0].dataset.id === viradas[1].dataset.id) {
                document.getElementById('som-ding').play();
                viradas.forEach(c => c.classList.add('certa'));
                viradas = []; travado = false;
                acertos++;
                if(acertos === totalPares) vitoria();
            } else {
                setTimeout(() => { 
                    viradas.forEach(c => c.classList.remove('virada')); 
                    viradas = []; travado = false; 
                }, 800);
            }
        }
    }

    function vitoria() {
        clearInterval(timerLoop);
        document.getElementById('som-win').play();
        confetti({ particleCount: 150, spread: 70 });
        let nome = document.getElementById('jogador').value;
        let tempoFinal = segundos.toFixed(1);
        salvar(nome, tempoFinal);
        setTimeout(() => { alert(`BOA, ${nome.toUpperCase()}! Tempo: ${tempoFinal}s`); voltarMenu(); }, 500);
    }

    // 3. FUN√á√ÉO VOLTAR (Quando sai do jogo para o menu)
    function voltarMenu() {
        clearInterval(timerLoop);
        document.getElementById('tela-jogo').style.display = 'none';
        document.getElementById('tela-menu').style.display = 'flex';
        
        if(!isMuted) {
            canalJogo.pause(); // Para Flauta
            canalMenu.play().catch(e => {}); // Volta Naruto
        }
        atualizarRank();
    }
    function salvar(n, t) {
        let key = 'anna_rank';
        let lista = JSON.parse(localStorage.getItem(key)) || [];
        lista.push({n, t: parseFloat(t)});
        lista.sort((a,b) => a.t - b.t);
        localStorage.setItem(key, JSON.stringify(lista.slice(0, 5)));
    }

    function atualizarRank() {
        let lista = JSON.parse(localStorage.getItem('anna_rank')) || [];
        let html = lista.length ? "" : "Sem recordes.";
        lista.forEach((r, i) => {
            html += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:3px;">
                        <span>${i+1}. ${r.n}</span><span>${r.t}s</span>
                     </div>`;
        });
        document.getElementById('ranking-area').innerHTML = html;
    }

    function fecharApp() { if(confirm("Sair?")) window.close(); }
    window.onload = atualizarRank;
</script> 
</body>
</html>